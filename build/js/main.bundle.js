(()=>{"use strict";const e=35.65858,t=139.74544,o=document.querySelector("#card").content.querySelector(".popup"),r=e=>{const t=o.cloneNode(!0);switch(t.querySelector("img").src=e.author.avatar,t.querySelector(".popup__title").textContent=e.offer.title,t.querySelector(".popup__text--address").innerHTML=e.offer.address,t.querySelector(".popup__text--price").innerHTML=`${e.offer.price}&#x20bd/ночь`,e.offer.type){case"bungalow":t.querySelector(".popup__type").textContent="Бунгало";break;case"flat":t.querySelector(".popup__type").textContent="Квартира";break;case"house":t.querySelector(".popup__type").textContent="Дом";break;case"palace":t.querySelector(".popup__type").textContent="Дворец"}t.querySelector(".popup__text--capacity").textContent=`${e.offer.rooms} комнаты для ${e.offer.guests} гостей`,t.querySelector(".popup__text--time").textContent=`Заезд после ${e.offer.checkin}, выезд до ${e.offer.checkout}`;const r=t.querySelector(".popup__features"),n=e.offer.features;r.innerHTML="";for(let e=0;e<n.length;e++){const t=`<li class="popup__feature popup__feature--${n[e]}"></li>`;r.insertAdjacentHTML("beforeend",t)}t.querySelector(".popup__description").textContent=e.offer.description;const a=t.querySelector(".popup__photos"),s=e.offer.photos;a.innerHTML="";for(let e=0;e<s.length;e++){const t=`<img src="${s[e]}" class="popup__photo" width="45" height="40" alt="Фотография жилья"></img>`;a.insertAdjacentHTML("beforeend",t)}return t};let n=1e3,a="Квартира";const s=()=>{const e=p.value;e>1e6?p.setCustomValidity("Больше миллиона цена быть не может"):e<n?p.setCustomValidity(`Меньше ${n} цены на объект "${a}" быть не может`):p.setCustomValidity(""),p.reportValidity()},c=(e,t)=>{t.value=e.value},i=(e,t)=>{"100"===e.value&&"0"!==t.value?t.setCustomValidity("Выбранное помещение не предназначено для проживания гостей"):"100"!==e.value&&"0"===t.value?t.setCustomValidity('Варианту "не для гостей" соответствует только помещение в 100 комнат'):e.value<t.value?t.setCustomValidity("Количество гостей не может быть больше количества мест"):t.setCustomValidity(""),t.reportValidity()},l=document.querySelector(".ad-form"),d=document.querySelector("#title"),u=l.querySelector("#type"),p=l.querySelector("#price"),y=l.querySelector("#timein"),f=l.querySelector("#timeout"),m=l.querySelector("#address"),g=document.querySelector("#room_number"),h=document.querySelector("#capacity"),v=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),S=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),q=l.querySelector(".ad-form__reset"),b=l.querySelectorAll("fieldset"),k=document.querySelector("main");d.addEventListener("input",(()=>{const e=d.value.length;e<30?d.setCustomValidity("Добавьте "+(30-e)+" симв."):e>100?d.setCustomValidity("Удалите "+(e-100)+" симв."):d.setCustomValidity(""),d.reportValidity()})),d.addEventListener("invalid",(()=>{d.validity.valueMissing&&d.setCustomValidity("Без заголовка объявление не публикуется")})),u.addEventListener("change",(e=>{switch(e.target.value){case"bungalow":n=0,a="Бунгало";break;case"flat":n=1e3,a="Квартира";break;case"house":n=5e3,a="Дом";break;case"palace":n=1e4,a="Дворец"}p.placeholder=n,s()})),p.addEventListener("input",(()=>{s()})),p.addEventListener("invalid",(()=>{p.validity.valueMissing&&p.setCustomValidity("Без указания цены объявление не публикуется")})),f.addEventListener("change",(()=>{c(f,y)})),y.addEventListener("change",(()=>{c(y,f)})),i(g,h),h.addEventListener("change",(function(){i(g,h)})),g.addEventListener("change",(function(){i(g,h)}));const C=e=>{k.appendChild(S),document.querySelector(".error__message").textContent=e,document.addEventListener("click",(()=>{k.contains(S)&&k.removeChild(S)})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&k.contains(S)&&k.removeChild(S)}))},E=(e,t)=>{m.value=`${e}, ${t}`};m.readOnly=!0,c(y,f);const x=document.querySelector(".map__filters"),w=x.querySelectorAll("select, fieldset"),V=e=>{(e=>{e?l.classList.add("ad-form--disabled"):l.classList.remove("ad-form--disabled"),b.forEach((t=>{t.disabled=e}))})(e),(e=>{e?x.classList.add("map__filters--disabled"):x.classList.remove("map__filters--disabled"),w.forEach((t=>{t.disabled=e}))})(e)};V(!0);const $=L.map("map-canvas").on("load",(()=>{V(!1)})).setView({lat:e,lng:t},9);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo($);const T=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),M=L.marker({lat:e,lng:t},{draggable:!0,icon:T}),A=()=>{M.setLatLng({lat:e,lng:t}),$.setView({lat:e,lng:t},9)};M.addTo($),E(e,t),M.on("move",(e=>{const t=e.target.getLatLng().lat,o=e.target.getLatLng().lng,r=Math.round(t*10**5)/10**5,n=Math.round(o*10**5)/10**5;E(r,n)}));const j=L.icon({iconUrl:"./img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),H=L.layerGroup().addTo($),z=e=>{const t=e.length<=10?e.length:10;H.getLayers().length&&H.clearLayers();for(let o=0;o<t;o++){const t=L.marker({lat:e[o].location.lat,lng:e[o].location.lng},{icon:j});t.bindPopup(r(e[o])),H.addLayer(t)}},D=["gif","jpg","jpeg","png"],R=l.querySelector(".ad-form__field input[type=file]"),U=l.querySelector(".ad-form-header__preview img"),F=l.querySelector(".ad-form__upload input[type=file]"),I=l.querySelector(".ad-form__photo");var N,O,P;R.addEventListener("change",(function(){const e=R.files[0],t=e.name.toLowerCase();if(D.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(function(){U.src=t.result})),t.readAsDataURL(e)}})),F.addEventListener("change",(function(){const e=F.files[0],t=e.name.toLowerCase();if(D.some((e=>t.endsWith(e)))){let t=new FileReader;t.addEventListener("load",(function(){I.innerHTML=`<img src="${t.result}" alt="Фото жилья" width="70" height="70"></img>`})),t.readAsDataURL(e)}})),(e=>{const t=()=>{k.appendChild(v),document.addEventListener("click",(()=>{k.contains(v)&&(k.removeChild(v),l.reset(),e())})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&k.contains(v)&&(k.removeChild(v),l.reset(),e())}))};l.addEventListener("submit",(e=>{e.preventDefault();const o=new FormData(e.target);var r,n;r=t,n=C,fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:o}).then((e=>{e.ok?r():n(`${e.status} (${e.statusText}).`)})).catch((e=>{n(e)}))}))})(A),N=A,q.addEventListener("click",(o=>{o.preventDefault(),l.reset(),N(),E(e,t)})),O=e=>{var t,o;z(e),t=_.debounce(z,500),o=e,x.addEventListener("change",(()=>{const e=o.filter((e=>(e=>{const t=document.querySelector("#housing-type option:checked").value;return t===e.offer.type||"any"===t})(e)&&(e=>{let t=!1;switch(document.querySelector("#housing-price option:checked").value){case"any":t=!0;break;case"low":t=e.offer.price<=1e4;break;case"middle":t=e.offer.price>1e4&&e.offer.price<5e4;break;case"high":t=e.offer.price>=5e4}return t})(e)&&(e=>{const t=document.querySelector("#housing-rooms option:checked").value;return e.offer.rooms===parseInt(t,10)||"any"===t})(e)&&(e=>{const t=document.querySelector("#housing-guests option:checked").value;return e.offer.guests===parseInt(t,10)||"any"===t})(e)&&(e=>{const t=document.querySelectorAll("#housing-features input");let o=!0;for(let r=0;r<t.length;r++)if(t[r].checked&&!e.offer.features.includes(t[r].value)){o=!1;break}return o})(e)));t(e)}))},P=e=>{const t=document.createElement("div");t.style="border: 5px solid red; z-index: 100; margin: 0 auto; text-align: center; background-color: yellow; color: red; padding: 0;",t.style.position="fixed",t.style.left=0,t.style.right=0,t.style.zIndex=3,t.style.top="595px",t.style.width="1200px",t.style.fontSize="50px",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)},fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} (${e.statusText}).`)})).then((e=>{O(e)})).catch((e=>{P(e)}))})();
//# sourceMappingURL=main.bundle.js.map